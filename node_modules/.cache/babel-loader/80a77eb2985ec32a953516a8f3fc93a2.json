{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, WebGLRenderer, PCFSoftShadowMap, Vector3, Math as Math$1 } from 'three';\nimport { createContext, memo, useState, useRef, useLayoutEffect, useCallback, useEffect, createElement, useContext, useMemo } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\nvar version = \"2.4.3\";\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\n\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\n\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  } // Run global effects\n\n\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  state.current.subscribers.forEach(fn => fn(state.current, timestamp)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\n\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\n\nlet catalogue = {};\n\nconst extend = objects => void (catalogue = _extends({}, catalogue, objects));\n\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  } // Filter equals, events and reserved props\n\n\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => filteredProps[key] = undefined);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach(_ref => {\n      let key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const _entries$reverse = entries.reverse(),\n                  name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && target.copy) {\n          if (target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container) {\n  let _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else if (instance.isObject3D) {\n      // Common Threejs scene object\n      applyProps(instance, newProps, oldProps, true);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some(_ref3 => {\n        let key = _ref3[0],\n            val = _ref3[1];\n        return val !== argsOld[index][key];\n      }) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\n\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\n\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\n\nconst hasSymbol = typeof Symbol === 'function' && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\n\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\n\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\n\nconst stateContext = createContext({});\n\nfunction useMeasure() {\n  const ref = useRef(null);\n\n  const _useState = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  }),\n        bounds = _useState[0],\n        set = _useState[1];\n\n  const _useState2 = useState(() => new ResizeObserver(_ref => {\n    let entry = _ref[0];\n    return set(entry.contentRect);\n  })),\n        ro = _useState2[0];\n\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, [ref.current]);\n  return [ref, bounds];\n}\n\nfunction makeId(event) {\n  return event.object.uuid + '/' + event.index;\n}\n\nconst Canvas = memo(_ref2 => {\n  let children = _ref2.children,\n      gl = _ref2.gl,\n      camera = _ref2.camera,\n      orthographic = _ref2.orthographic,\n      raycaster = _ref2.raycaster,\n      style = _ref2.style,\n      pixelRatio = _ref2.pixelRatio,\n      _ref2$vr = _ref2.vr,\n      vr = _ref2$vr === void 0 ? false : _ref2$vr,\n      _ref2$shadowMap = _ref2.shadowMap,\n      shadowMap = _ref2$shadowMap === void 0 ? false : _ref2$shadowMap,\n      _ref2$invalidateFrame = _ref2.invalidateFrameloop,\n      invalidateFrameloop = _ref2$invalidateFrame === void 0 ? false : _ref2$invalidateFrame,\n      _ref2$updateDefaultCa = _ref2.updateDefaultCamera,\n      updateDefaultCamera = _ref2$updateDefaultCa === void 0 ? true : _ref2$updateDefaultCa,\n      onCreated = _ref2.onCreated,\n      onPointerMissed = _ref2.onPointerMissed,\n      rest = _objectWithoutPropertiesLoose(_ref2, [\"children\", \"gl\", \"camera\", \"orthographic\", \"raycaster\", \"style\", \"pixelRatio\", \"vr\", \"shadowMap\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"onCreated\", \"onPointerMissed\"]); // Local, reactive state\n\n\n  const _useState3 = useState(false),\n        ready = _useState3[0],\n        setReady = _useState3[1];\n\n  const _useMeasure = useMeasure(),\n        bind = _useMeasure[0],\n        size = _useMeasure[1];\n\n  const _useState4 = useState(() => new Vector2()),\n        mouse = _useState4[0];\n\n  const _useState5 = useState(() => {\n    const element = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas');\n    element.style.display = 'block';\n    return element;\n  }),\n        defaultCanvas = _useState5[0];\n\n  const _useState6 = useState(() => {\n    const ray = new Raycaster();\n    if (raycaster) applyProps(ray, raycaster, {});\n    return ray;\n  }),\n        defaultRaycaster = _useState6[0];\n\n  const _useState7 = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n        defaultScene = _useState7[0];\n\n  const _useState8 = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n        defaultCam = _useState8[0],\n        _setDefaultCamera = _useState8[1];\n\n  const _useState9 = useState(() => {\n    const renderer = new WebGLRenderer(_extends({\n      canvas: defaultCanvas,\n      antialias: true,\n      alpha: true\n    }, gl));\n    renderer.setClearAlpha(0);\n\n    if (shadowMap) {\n      if (typeof shadowMap === 'object') {\n        renderer.shadowMap.enabled = true;\n        Object.assign(renderer, shadowMap);\n      } else {\n        renderer.shadowMap.enabled = true;\n        renderer.shadowMap.type = PCFSoftShadowMap;\n      }\n    }\n\n    return renderer;\n  }),\n        defaultRenderer = _useState9[0]; // Public state\n\n\n  const state = useRef({\n    ready: false,\n    manual: false,\n    vr: false,\n    active: true,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    gl: defaultRenderer,\n    canvas: defaultCanvas,\n    captured: undefined,\n    canvasRect: {\n      bottom: 0,\n      height: 0,\n      width: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      x: 0,\n      y: 0\n    },\n    size: {\n      left: 0,\n      top: 0,\n      width: 0,\n      height: 0\n    },\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    subscribe: fn => {\n      state.current.subscribers.push(fn);\n      return () => state.current.subscribers = state.current.subscribers.filter(s => s !== fn);\n    },\n    setManual: takeOverRenderloop => {\n      state.current.manual = takeOverRenderloop;\n\n      if (takeOverRenderloop) {\n        // In manual mode items shouldn't really be part of the internal scene which has adverse effects\n        // on the camera being unable to update without explicit calls to updateMatrixWorl()\n        state.current.scene.children.forEach(child => state.current.scene.remove(child));\n      }\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // This is used as a clone of the current state, to be distributed through context and useThree\n\n  const sharedState = useRef(state.current); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useLayoutEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n  }, [invalidateFrameloop, vr, ready, size, defaultCam]); // Manage canvas element in the dom\n\n  useLayoutEffect(() => {\n    // Add canvas to the view\n    if (bind.current) bind.current.appendChild(defaultCanvas); // Start render-loop, either via RAF or setAnimationLoop for VR\n\n    if (!state.current.vr) invalidate(state);else {\n      defaultRenderer.vr.enabled = true;\n      defaultRenderer.setAnimationLoop(t => renderGl(state, t, 0, true));\n    } // Dispose renderer on unmount\n\n    return () => {\n      if (defaultRenderer) {\n        defaultRenderer.forceContextLoss();\n        defaultRenderer.dispose();\n      }\n\n      state.current.gl = undefined;\n      state.current.active = false;\n      unmountComponentAtNode(state.current.scene);\n    };\n  }, []); // Update pixel ratio\n\n  useLayoutEffect(() => {\n    if (pixelRatio) defaultRenderer.setPixelRatio(pixelRatio);\n  }, [pixelRatio]); // Adjusts default camera\n\n  useLayoutEffect(() => {\n    state.current.aspect = size.width / size.height || 0;\n\n    if (isOrthographicCamera(state.current.camera)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // Get canvas dom bounds\n\n\n    if (bind.current) state.current.canvasRect = bind.current.getBoundingClientRect();\n\n    if (ready) {\n      defaultRenderer.setSize(size.width, size.height);\n      /* https://github.com/drcmda/react-three-fiber/issues/92\n         Sometimes automatic default camera adjustment isn't wanted behaviour */\n\n      if (updateDefaultCamera) {\n        if (isOrthographicCamera(state.current.camera)) {\n          state.current.camera.left = size.width / -2;\n          state.current.camera.right = size.width / 2;\n          state.current.camera.top = size.height / 2;\n          state.current.camera.bottom = size.height / -2;\n        } else {\n          state.current.camera.aspect = state.current.aspect; // TODO: Why radius??\n          // state.current.camera.radius = (size.width + size.height) / 4\n        }\n\n        state.current.camera.updateProjectionMatrix();\n      }\n\n      invalidate(state);\n    } // Only trigger the context provider when necessary\n\n\n    sharedState.current = _extends({}, state.current);\n  }, [ready, size, defaultCam, updateDefaultCamera]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = useCallback(() => void (setReady(true), invalidate(state)), []);\n    useEffect(() => {\n      if (onCreated) {\n        const result = onCreated(state.current);\n        if (result && result.then) return void result.then(activate);\n      }\n\n      activate();\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    if (size.width > 0 && size.height > 0) {\n      render(createElement(stateContext.Provider, {\n        value: sharedState.current\n      }, createElement(IsReady, null), typeof children === 'function' ? children(state.current) : children), state.current.scene, state);\n    }\n  });\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      const canvasRect = state.current.canvasRect;\n      const left = canvasRect && canvasRect.left || 0;\n      const right = canvasRect && canvasRect.right || 0;\n      const top = canvasRect && canvasRect.top || 0;\n      const bottom = canvasRect && canvasRect.bottom || 0;\n      const x = (event.clientX - left) / (right - left) * 2 - 1;\n      const y = -((event.clientY - top) / (bottom - top)) * 2 + 1;\n      mouse.set(x, y);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    const intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    });\n\n    for (let intersect of intersects) {\n      let receivingObject = intersect.object;\n      let object = intersect.object; // Bubble event up\n\n      while (object) {\n        if (object.__handlers) hits.push(_extends({}, intersect, {\n          object,\n          receivingObject\n        }));\n        object = object.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n        fn(_extends({}, event, hit, {\n          stopped,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true,\n          sourceEvent: event\n        }));\n        if (stopped.current === true) break;\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    if (!state.current.ready) return; // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(object)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.object);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      let dx = event.clientX - state.current.initialClick[0];\n      let dy = event.clientY - state.current.initialClick[1];\n      let distance = Math.round(Math.sqrt(dx * dx + dy * dy));\n      if (distance <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  const hovered = new Map();\n  const handlePointerMove = useCallback(event => {\n    if (!state.current.ready) return;\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerOut) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation(); // In fact, wwe can safely remove them from the cache\n\n          Array.from(hovered.values()).forEach(data => {\n            const checkId = makeId(data);\n\n            if (checkId !== id) {\n              if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n                type: 'pointerout'\n              }));\n              hovered.delete(checkId);\n            }\n          });\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      if (hits && (!hits.length || !hits.find(i => i.object === data.object))) {\n        const object = data.object;\n        const handlers = object.__handlers;\n        if (handlers && handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []); // Render the canvas into the dom\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: event => handlePointerCancel(event, []),\n    onPointerMove: handlePointerMove // On capture intersect and remember the last known position\n    ,\n    onGotPointerCapture: event => state.current.captured = intersect(event, false) // On lost capture remove the captured hit\n    ,\n    onLostPointerCapture: event => (state.current.captured = undefined, handlePointerCancel(event))\n  }, rest, {\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }));\n});\n\nfunction useRender(fn, takeOverRenderloop, deps) {\n  if (takeOverRenderloop === void 0) {\n    takeOverRenderloop = false;\n  }\n\n  if (deps === void 0) {\n    deps = [];\n  }\n\n  const _useContext = useContext(stateContext),\n        subscribe = _useContext.subscribe,\n        setManual = _useContext.setManual; // This calls into the host to inform it whether the render-loop is manual or not\n\n\n  useMemo(() => takeOverRenderloop && setManual(true), [takeOverRenderloop]);\n  useEffect(() => {\n    // Subscribe to the render-loop\n    const unsubscribe = subscribe(fn);\n    return () => {\n      // Call subscription off on unmount\n      unsubscribe();\n      if (takeOverRenderloop) setManual(false);\n    };\n  }, deps);\n}\n\nfunction useThree() {\n  const _useContext2 = useContext(stateContext),\n        subscribe = _useContext2.subscribe,\n        props = _objectWithoutPropertiesLoose(_useContext2, [\"subscribe\"]);\n\n  return props;\n}\n\nfunction useUpdate(callback, dependents, optionalRef) {\n  const _useContext3 = useContext(stateContext),\n        invalidate = _useContext3.invalidate;\n\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\n\nfunction useResource(optionalRef) {\n  const _useState = useState(),\n        resource = _useState[0],\n        set = _useState[1];\n\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => void set(ref.current), [ref.current]);\n  return [ref, resource];\n}\n/** experimental */\n\n\nfunction useLoader(proto, url, extensions) {\n  const key = useMemo(() => ({}), [url]);\n\n  const _useState2 = useState(() => new WeakMap()),\n        cache = _useState2[0];\n\n  const loader = useMemo(() => {\n    const temp = new proto();\n    if (extensions) extensions(temp);\n    return temp;\n  }, [proto]);\n\n  const _useState3 = useState(false),\n        _ = _useState3[0],\n        forceUpdate = _useState3[1];\n\n  useEffect(() => {\n    if (!cache.has(key)) {\n      loader.load(url, gltf => {\n        const temp = [];\n        gltf.scene.traverse(obj => obj.isMesh && temp.push({\n          geometry: obj.geometry,\n          material: obj.material\n        }));\n        cache.set(key, temp);\n        forceUpdate(i => !i);\n      });\n    }\n  }, [proto, key]);\n  return cache.get(key) || [];\n}\n\nconst apply = objects => {\n  console.warn('react-three-fiber: Please use extend ✅ instead of apply ❌, the former will be made obsolete soon!');\n  extend(objects);\n};\n\nexport { Canvas, addEffect, apply, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, stateContext, unmountComponentAtNode, useLoader, useRender, useResource, useThree, useUpdate };","map":{"version":3,"sources":["/media/adarsh/New Volume/project/face recognition app/node_modules/react-three-fiber/dist/index.js"],"names":["_extends","_objectWithoutPropertiesLoose","THREE","Vector2","Raycaster","Scene","OrthographicCamera","PerspectiveCamera","WebGLRenderer","PCFSoftShadowMap","Vector3","Math","Math$1","createContext","memo","useState","useRef","useLayoutEffect","useCallback","useEffect","createElement","useContext","useMemo","ResizeObserver","Reconciler","unstable_now","unstable_scheduleCallback","unstable_cancelCallback","unstable_runWithPriority","unstable_IdlePriority","version","_toPropertyKey","arg","key","_toPrimitive","String","input","hint","prim","Symbol","toPrimitive","undefined","res","call","TypeError","Number","roots","Map","emptyObject","is","obj","a","Object","str","num","und","arr","Array","isArray","equ","b","i","globalEffects","addEffect","callback","push","renderGl","state","timestamp","repeat","runGlobalEffects","forEach","effect","current","subscribers","fn","frames","max","invalidateFrameloop","manual","gl","render","scene","camera","running","renderLoop","root","containerInfo","__state","active","ready","requestAnimationFrame","invalidate","vr","catalogue","extend","objects","applyProps","instance","newProps","oldProps","accumulative","container","__container","sameProps","keys","filter","handlers","startsWith","leftOvers","filteredProps","reduce","acc","prop","_","rest","map","length","entries","_ref","value","includes","target","split","set","_entries$reverse","reverse","name","reverseEntries","slice","copy","constructor","invalidateInstance","raycast","__handlers","index","__interaction","indexOf","splice","charAt","toLowerCase","substr","parent","updateInstance","update","createInstance","type","_ref2","_ref2$args","args","props","toUpperCase","object","__instance","__objects","appendChild","parentInstance","child","isObject3D","add","attach","attachArray","attachObject","insertBefore","beforeChild","dispatchEvent","children","removeRecursive","array","clone","removeChild","remove","x","dispose","switchInstance","fiber","newInstance","alternate","stateNode","ref","Renderer","now","supportsMutation","isPrimaryRenderer","schedulePassiveEffects","cancelPassiveEffects","appendInitialChild","appendChildToContainer","removeChildFromContainer","insertInContainerBefore","commitUpdate","updatePayload","_newProps$args","argsNew","restNew","_oldProps$args","argsOld","restOld","hasNewArgs","some","_ref3","val","hideInstance","visible","unhideInstance","getPublicInstance","getRootHostContext","getChildHostContext","createTextInstance","finalizeInitialChildren","prepareUpdate","shouldDeprioritizeSubtree","prepareForCommit","resetAfterCommit","shouldSetTextContent","element","get","newRoot","createContainer","updateContainer","getPublicRootInstance","unmountComponentAtNode","delete","hasSymbol","for","REACT_PORTAL_TYPE","createPortal","implementation","$$typeof","injectIntoDevTools","bundleType","process","env","NODE_ENV","rendererPackageName","findHostInstanceByFiber","findHostInstance","isOrthographicCamera","def","stateContext","useMeasure","_useState","left","top","width","height","bounds","_useState2","entry","contentRect","ro","observe","disconnect","makeId","event","uuid","Canvas","orthographic","raycaster","style","pixelRatio","_ref2$vr","_ref2$shadowMap","shadowMap","_ref2$invalidateFrame","_ref2$updateDefaultCa","updateDefaultCamera","onCreated","onPointerMissed","_useState3","setReady","_useMeasure","bind","size","_useState4","mouse","_useState5","document","createElementNS","display","defaultCanvas","_useState6","ray","defaultRaycaster","_useState7","defaultScene","_useState8","cam","position","z","defaultCam","_setDefaultCamera","_useState9","renderer","canvas","antialias","alpha","setClearAlpha","enabled","assign","defaultRenderer","aspect","captured","canvasRect","bottom","right","y","viewport","factor","initialClick","initialHits","subscribe","s","setManual","takeOverRenderloop","setDefaultCamera","intersect","handlePointerMove","sharedState","setAnimationLoop","t","forceContextLoss","setPixelRatio","distance","distanceTo","fov","degToRad","tan","getBoundingClientRect","setSize","updateProjectionMatrix","IsReady","activate","result","then","Provider","prepareRay","clientX","clientY","setFromCamera","prepare","seen","Set","hits","intersects","intersectObjects","item","id","has","receivingObject","handleIntersects","unprojectedPoint","unproject","hit","stopped","stopPropagation","sourceEvent","handlePointer","data","dx","dy","round","sqrt","hovered","pointerMove","pointerOver","pointerOut","hoveredItem","from","values","checkId","handlePointerCancel","find","onClick","onWheel","onPointerDown","onPointerUp","onPointerLeave","onPointerMove","onGotPointerCapture","onLostPointerCapture","overflow","useRender","deps","_useContext","unsubscribe","useThree","_useContext2","useUpdate","dependents","optionalRef","_useContext3","localRef","useResource","resource","useLoader","proto","url","extensions","WeakMap","cache","loader","temp","forceUpdate","load","gltf","traverse","isMesh","geometry","material","apply","console","warn"],"mappings":"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","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport * as THREE from 'three';\nimport { Vector2, Raycaster, Scene, OrthographicCamera, PerspectiveCamera, WebGLRenderer, PCFSoftShadowMap, Vector3, Math as Math$1 } from 'three';\nimport { createContext, memo, useState, useRef, useLayoutEffect, useCallback, useEffect, createElement, useContext, useMemo } from 'react';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport Reconciler from 'react-reconciler';\nimport { unstable_now, unstable_scheduleCallback, unstable_cancelCallback, unstable_runWithPriority, unstable_IdlePriority } from 'scheduler';\n\nvar version = \"2.4.3\";\n\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\n\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\nconst roots = new Map();\nconst emptyObject = {};\nconst is = {\n  obj: a => a === Object(a),\n  str: a => typeof a === 'string',\n  num: a => typeof a === 'number',\n  und: a => a === void 0,\n  arr: a => Array.isArray(a),\n\n  equ(a, b) {\n    // Wrong type, doesn't match\n    if (typeof a !== typeof b) return false; // Atomic, just compare a against b\n\n    if (is.str(a) || is.num(a) || is.obj(a)) return a === b; // Array, shallow compare first to see if it's a match\n\n    if (is.arr(a) && a == b) return true; // Last resort, go through keys\n\n    let i;\n\n    for (i in a) if (!(i in b)) return false;\n\n    for (i in b) if (a[i] !== b[i]) return false;\n\n    return is.und(i) ? a === b : true;\n  }\n\n};\nlet globalEffects = [];\nfunction addEffect(callback) {\n  globalEffects.push(callback);\n}\nfunction renderGl(state, timestamp, repeat, runGlobalEffects) {\n  if (repeat === void 0) {\n    repeat = 0;\n  }\n\n  if (runGlobalEffects === void 0) {\n    runGlobalEffects = false;\n  }\n\n  // Run global effects\n  if (runGlobalEffects) globalEffects.forEach(effect => effect(timestamp) && repeat++); // Run local effects\n\n  state.current.subscribers.forEach(fn => fn(state.current, timestamp)); // Decrease frame count\n\n  state.current.frames = Math.max(0, state.current.frames - 1);\n  repeat += !state.current.invalidateFrameloop ? 1 : state.current.frames; // Render content\n\n  if (!state.current.manual && state.current.gl) state.current.gl.render(state.current.scene, state.current.camera);\n  return repeat;\n}\nlet running = false;\n\nfunction renderLoop(timestamp) {\n  running = true;\n  let repeat = 0; // Run global effects\n\n  globalEffects.forEach(effect => effect(timestamp) && repeat++);\n  roots.forEach(root => {\n    const state = root.containerInfo.__state; // If the frameloop is invalidated, do not run another frame\n\n    if (state.current.active && state.current.ready && (!state.current.invalidateFrameloop || state.current.frames > 0)) repeat = renderGl(state, timestamp, repeat);\n  });\n  if (repeat !== 0) return requestAnimationFrame(renderLoop); // Flag end of operation\n\n  running = false;\n}\n\nfunction invalidate(state, frames) {\n  if (state === void 0) {\n    state = true;\n  }\n\n  if (frames === void 0) {\n    frames = 2;\n  }\n\n  if (state === true) roots.forEach(root => root.containerInfo.__state.current.frames = frames);else if (state && state.current) {\n    if (state.current.vr) return;\n    state.current.frames = frames;\n  }\n\n  if (!running) {\n    running = true;\n    requestAnimationFrame(renderLoop);\n  }\n}\nlet catalogue = {};\nconst extend = objects => void (catalogue = _extends({}, catalogue, objects));\nfunction applyProps(instance, newProps, oldProps, accumulative) {\n  if (oldProps === void 0) {\n    oldProps = {};\n  }\n\n  if (accumulative === void 0) {\n    accumulative = false;\n  }\n\n  // Filter equals, events and reserved props\n  const container = instance.__container;\n  const sameProps = Object.keys(newProps).filter(key => is.equ(newProps[key], oldProps[key]));\n  const handlers = Object.keys(newProps).filter(key => typeof newProps[key] === 'function' && key.startsWith('on'));\n  const leftOvers = accumulative ? Object.keys(oldProps).filter(key => newProps[key] === void 0) : [];\n  const filteredProps = [...sameProps, 'children', 'key', 'ref'].reduce((acc, prop) => {\n    let _ = acc[prop],\n        rest = _objectWithoutPropertiesLoose(acc, [prop].map(_toPropertyKey));\n\n    return rest;\n  }, newProps); // Add left-overs as undefined props so they can be removed\n\n  leftOvers.forEach(key => filteredProps[key] = undefined);\n\n  if (Object.keys(filteredProps).length > 0) {\n    Object.entries(filteredProps).forEach((_ref) => {\n      let key = _ref[0],\n          value = _ref[1];\n\n      if (!handlers.includes(key)) {\n        let root = instance;\n        let target = root[key];\n\n        if (key.includes('-')) {\n          const entries = key.split('-');\n          target = entries.reduce((acc, key) => acc[key], instance); // If the target is atomic, it forces us to switch the root\n\n          if (!(target && target.set)) {\n            const _entries$reverse = entries.reverse(),\n                  name = _entries$reverse[0],\n                  reverseEntries = _entries$reverse.slice(1);\n\n            root = reverseEntries.reverse().reduce((acc, key) => acc[key], instance);\n            key = name;\n          }\n        } // Special treatment for objects with support for set/copy\n\n\n        if (target && target.set && target.copy) {\n          if (target.constructor.name === value.constructor.name) target.copy(value);else if (Array.isArray(value)) target.set(...value);else target.set(value); // Else, just overwrite the value\n        } else root[key] = value;\n\n        invalidateInstance(instance);\n      }\n    }); // Preemptively delete the instance from the containers interaction\n\n    if (accumulative && container && instance.raycast && instance.__handlers) {\n      instance.__handlers = undefined;\n\n      const index = container.__interaction.indexOf(instance);\n\n      if (index > -1) container.__interaction.splice(index, 1);\n    } // Prep interaction handlers\n\n\n    if (handlers.length) {\n      // Add interactive object to central container\n      if (container && instance.raycast) {\n        // Unless the only onUpdate is the only event present we flag the instance as interactive\n        if (!(handlers.length === 1 && handlers[0] === 'onUpdate')) container.__interaction.push(instance);\n      } // Add handlers to the instances handler-map\n\n\n      instance.__handlers = handlers.reduce((acc, key) => _extends({}, acc, {\n        [key.charAt(2).toLowerCase() + key.substr(3)]: newProps[key]\n      }), {});\n    } // Call the update lifecycle when it is being updated, but only when it is part of the scene\n\n\n    if (instance.parent) updateInstance(instance);\n  }\n}\n\nfunction invalidateInstance(instance) {\n  if (instance.__container && instance.__container.__state) invalidate(instance.__container.__state);\n}\n\nfunction updateInstance(instance) {\n  if (instance.__handlers && instance.__handlers.update) instance.__handlers.update(instance);\n}\n\nfunction createInstance(type, _ref2, container) {\n  let _ref2$args = _ref2.args,\n      args = _ref2$args === void 0 ? [] : _ref2$args,\n      props = _objectWithoutPropertiesLoose(_ref2, [\"args\"]);\n\n  let name = \"\" + type[0].toUpperCase() + type.slice(1);\n  let instance;\n\n  if (type === 'primitive') {\n    instance = props.object;\n    instance.__instance = true;\n  } else {\n    const target = catalogue[name] || THREE[name];\n    instance = is.arr(args) ? new target(...args) : new target(args);\n  } // Bind to the root container in case portals are being used\n  // This is perhaps better for event management as we can keep them on a single instance\n\n\n  while (container.__container) {\n    container = container.__container;\n  } // Apply initial props\n\n\n  instance.__objects = [];\n  instance.__container = container; // It should NOT call onUpdate on object instanciation, because it hasn't been added to the\n  // view yet. If the callback relies on references for instance, they won't be ready yet, this is\n  // why it passes \"false\" here\n\n  applyProps(instance, props, {});\n  return instance;\n}\n\nfunction appendChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) parentInstance.add(child);else {\n      parentInstance.__objects.push(child);\n\n      child.parent = parentInstance; // The attach attribute implies that the object attaches itself on the parent\n\n      if (child.attach) parentInstance[child.attach] = child;else if (child.attachArray) {\n        if (!is.arr(parentInstance[child.attachArray])) parentInstance[child.attachArray] = [];\n        parentInstance[child.attachArray].push(child);\n      } else if (child.attachObject) {\n        if (!is.obj(parentInstance[child.attachObject[0]])) parentInstance[child.attachObject[0]] = {};\n        parentInstance[child.attachObject[0]][child.attachObject[1]] = child;\n      }\n    }\n    updateInstance(child);\n    invalidateInstance(child);\n  }\n}\n\nfunction insertBefore(parentInstance, child, beforeChild) {\n  if (child) {\n    if (child.isObject3D) {\n      child.parent = parentInstance;\n      child.dispatchEvent({\n        type: 'added'\n      }); // TODO: the order is out of whack if data objects are present, has to be recalculated\n\n      const index = parentInstance.children.indexOf(beforeChild);\n      parentInstance.children = [...parentInstance.children.slice(0, index), child, ...parentInstance.children.slice(index)];\n      updateInstance(child);\n    } else appendChild(parentInstance, child); // TODO: order!!!\n\n\n    invalidateInstance(child);\n  }\n}\n\nfunction removeRecursive(array, parent, clone) {\n  if (clone === void 0) {\n    clone = false;\n  }\n\n  if (array) {\n    // Three uses splice op's internally we may have to shallow-clone the array in order to safely remove items\n    const target = clone ? [...array] : array;\n    target.forEach(child => removeChild(parent, child));\n  }\n}\n\nfunction removeChild(parentInstance, child) {\n  if (child) {\n    if (child.isObject3D) {\n      parentInstance.remove(child);\n    } else {\n      child.parent = null;\n      parentInstance.__objects = parentInstance.__objects.filter(x => x !== child); // Remove attachment\n\n      if (child.attach) parentInstance[child.attach] = null;else if (child.attachArray) parentInstance[child.attachArray] = parentInstance[child.attachArray].filter(x => x !== child);else if (child.attachObject) {\n        delete parentInstance[child.attachObject[0]][child.attachObject[1]];\n      }\n    }\n\n    invalidateInstance(child);\n    unstable_runWithPriority(unstable_IdlePriority, () => {\n      // Remove interactivity\n      if (child.__container) child.__container.__interaction = child.__container.__interaction.filter(x => x !== child); // Remove nested child objects\n\n      removeRecursive(child.__objects, child);\n      removeRecursive(child.children, child, true); // Dispose item\n\n      if (child.dispose) child.dispose(); // Remove references\n\n      delete child.__container;\n      delete child.__objects;\n    });\n  }\n}\n\nfunction switchInstance(instance, type, newProps, fiber) {\n  const parent = instance.parent;\n  const newInstance = createInstance(type, newProps, instance.__container);\n  removeChild(parent, instance);\n  appendChild(parent, newInstance) // This evil hack switches the react-internal fiber node\n  // https://github.com/facebook/react/issues/14983\n  // https://github.com/facebook/react/pull/15021\n  ;\n  [fiber, fiber.alternate].forEach(fiber => {\n    if (fiber !== null) {\n      fiber.stateNode = newInstance;\n\n      if (fiber.ref) {\n        if (typeof fiber.ref === 'function') fiber.ref(newInstance);else fiber.ref.current = newInstance;\n      }\n    }\n  });\n}\n\nconst Renderer = Reconciler({\n  now: unstable_now,\n  createInstance,\n  removeChild,\n  appendChild,\n  insertBefore,\n  supportsMutation: true,\n  isPrimaryRenderer: false,\n  // @ts-ignore\n  schedulePassiveEffects: unstable_scheduleCallback,\n  cancelPassiveEffects: unstable_cancelCallback,\n  appendInitialChild: appendChild,\n  appendChildToContainer: appendChild,\n  removeChildFromContainer: removeChild,\n  insertInContainerBefore: insertBefore,\n\n  commitUpdate(instance, updatePayload, type, oldProps, newProps, fiber) {\n    if (instance.__instance && newProps.object && newProps.object !== instance) {\n      // <instance object={...} /> where the object reference has changed\n      switchInstance(instance, type, newProps, fiber);\n    } else if (instance.isObject3D) {\n      // Common Threejs scene object\n      applyProps(instance, newProps, oldProps, true);\n    } else {\n      // This is a data object, let's extract critical information about it\n      const _newProps$args = newProps.args,\n            argsNew = _newProps$args === void 0 ? [] : _newProps$args,\n            restNew = _objectWithoutPropertiesLoose(newProps, [\"args\"]);\n\n      const _oldProps$args = oldProps.args,\n            argsOld = _oldProps$args === void 0 ? [] : _oldProps$args,\n            restOld = _objectWithoutPropertiesLoose(oldProps, [\"args\"]); // If it has new props or arguments, then it needs to be re-instanciated\n\n\n      const hasNewArgs = argsNew.some((value, index) => is.obj(value) ? Object.entries(value).some((_ref3) => {\n        let key = _ref3[0],\n            val = _ref3[1];\n        return val !== argsOld[index][key];\n      }) : value !== argsOld[index]);\n\n      if (hasNewArgs) {\n        // Next we create a new instance and append it again\n        switchInstance(instance, type, newProps, fiber);\n      } else {\n        // Otherwise just overwrite props\n        applyProps(instance, restNew, restOld, true);\n      }\n    }\n  },\n\n  hideInstance(instance) {\n    if (instance.isObject3D) {\n      instance.visible = false;\n      invalidateInstance(instance);\n    }\n  },\n\n  unhideInstance(instance, props) {\n    if (instance.isObject3D && props.visible == null || props.visible) {\n      instance.visible = true;\n      invalidateInstance(instance);\n    }\n  },\n\n  getPublicInstance(instance) {\n    return instance;\n  },\n\n  getRootHostContext() {\n    return emptyObject;\n  },\n\n  getChildHostContext() {\n    return emptyObject;\n  },\n\n  createTextInstance() {},\n\n  finalizeInitialChildren() {\n    return false;\n  },\n\n  prepareUpdate() {\n    return emptyObject;\n  },\n\n  shouldDeprioritizeSubtree() {\n    return false;\n  },\n\n  prepareForCommit() {},\n\n  resetAfterCommit() {},\n\n  shouldSetTextContent() {\n    return false;\n  }\n\n});\nfunction render(element, container, state) {\n  let root = roots.get(container);\n\n  if (!root) {\n    container.__state = state;\n    let newRoot = root = Renderer.createContainer(container, false, false);\n    roots.set(container, newRoot);\n  }\n\n  Renderer.updateContainer(element, root, null, () => undefined);\n  return Renderer.getPublicRootInstance(root);\n}\nfunction unmountComponentAtNode(container) {\n  const root = roots.get(container);\n  if (root) Renderer.updateContainer(null, root, null, () => void roots.delete(container));\n}\nconst hasSymbol = typeof Symbol === 'function' && Symbol.for;\nconst REACT_PORTAL_TYPE = hasSymbol ? Symbol.for('react.portal') : 0xeaca;\nfunction createPortal(children, containerInfo, implementation, key) {\n  if (key === void 0) {\n    key = null;\n  }\n\n  return {\n    $$typeof: REACT_PORTAL_TYPE,\n    key: key == null ? null : '' + key,\n    children,\n    containerInfo,\n    implementation\n  };\n}\nRenderer.injectIntoDevTools({\n  bundleType: process.env.NODE_ENV === 'production' ? 0 : 1,\n  version: version,\n  rendererPackageName: 'react-three-fiber',\n  findHostInstanceByFiber: Renderer.findHostInstance\n});\n\nfunction isOrthographicCamera(def) {\n  return def.isOrthographicCamera;\n}\nconst stateContext = createContext({});\n\nfunction useMeasure() {\n  const ref = useRef(null);\n\n  const _useState = useState({\n    left: 0,\n    top: 0,\n    width: 0,\n    height: 0\n  }),\n        bounds = _useState[0],\n        set = _useState[1];\n\n  const _useState2 = useState(() => new ResizeObserver((_ref) => {\n    let entry = _ref[0];\n    return set(entry.contentRect);\n  })),\n        ro = _useState2[0];\n\n  useEffect(() => {\n    if (ref.current) ro.observe(ref.current);\n    return () => ro.disconnect();\n  }, [ref.current]);\n  return [ref, bounds];\n}\n\nfunction makeId(event) {\n  return event.object.uuid + '/' + event.index;\n}\n\nconst Canvas = memo((_ref2) => {\n  let children = _ref2.children,\n      gl = _ref2.gl,\n      camera = _ref2.camera,\n      orthographic = _ref2.orthographic,\n      raycaster = _ref2.raycaster,\n      style = _ref2.style,\n      pixelRatio = _ref2.pixelRatio,\n      _ref2$vr = _ref2.vr,\n      vr = _ref2$vr === void 0 ? false : _ref2$vr,\n      _ref2$shadowMap = _ref2.shadowMap,\n      shadowMap = _ref2$shadowMap === void 0 ? false : _ref2$shadowMap,\n      _ref2$invalidateFrame = _ref2.invalidateFrameloop,\n      invalidateFrameloop = _ref2$invalidateFrame === void 0 ? false : _ref2$invalidateFrame,\n      _ref2$updateDefaultCa = _ref2.updateDefaultCamera,\n      updateDefaultCamera = _ref2$updateDefaultCa === void 0 ? true : _ref2$updateDefaultCa,\n      onCreated = _ref2.onCreated,\n      onPointerMissed = _ref2.onPointerMissed,\n      rest = _objectWithoutPropertiesLoose(_ref2, [\"children\", \"gl\", \"camera\", \"orthographic\", \"raycaster\", \"style\", \"pixelRatio\", \"vr\", \"shadowMap\", \"invalidateFrameloop\", \"updateDefaultCamera\", \"onCreated\", \"onPointerMissed\"]);\n\n  // Local, reactive state\n  const _useState3 = useState(false),\n        ready = _useState3[0],\n        setReady = _useState3[1];\n\n  const _useMeasure = useMeasure(),\n        bind = _useMeasure[0],\n        size = _useMeasure[1];\n\n  const _useState4 = useState(() => new Vector2()),\n        mouse = _useState4[0];\n\n  const _useState5 = useState(() => {\n    const element = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas');\n    element.style.display = 'block';\n    return element;\n  }),\n        defaultCanvas = _useState5[0];\n\n  const _useState6 = useState(() => {\n    const ray = new Raycaster();\n    if (raycaster) applyProps(ray, raycaster, {});\n    return ray;\n  }),\n        defaultRaycaster = _useState6[0];\n\n  const _useState7 = useState(() => {\n    const scene = new Scene();\n    scene.__interaction = [];\n    scene.__objects = [];\n    return scene;\n  }),\n        defaultScene = _useState7[0];\n\n  const _useState8 = useState(() => {\n    const cam = orthographic ? new OrthographicCamera(0, 0, 0, 0, 0.1, 1000) : new PerspectiveCamera(75, 0, 0.1, 1000);\n    cam.position.z = 5;\n    if (camera) applyProps(cam, camera, {});\n    return cam;\n  }),\n        defaultCam = _useState8[0],\n        _setDefaultCamera = _useState8[1];\n\n  const _useState9 = useState(() => {\n    const renderer = new WebGLRenderer(_extends({\n      canvas: defaultCanvas,\n      antialias: true,\n      alpha: true\n    }, gl));\n    renderer.setClearAlpha(0);\n\n    if (shadowMap) {\n      if (typeof shadowMap === 'object') {\n        renderer.shadowMap.enabled = true;\n        Object.assign(renderer, shadowMap);\n      } else {\n        renderer.shadowMap.enabled = true;\n        renderer.shadowMap.type = PCFSoftShadowMap;\n      }\n    }\n\n    return renderer;\n  }),\n        defaultRenderer = _useState9[0]; // Public state\n\n\n  const state = useRef({\n    ready: false,\n    manual: false,\n    vr: false,\n    active: true,\n    invalidateFrameloop: false,\n    frames: 0,\n    aspect: 0,\n    subscribers: [],\n    camera: defaultCam,\n    scene: defaultScene,\n    raycaster: defaultRaycaster,\n    mouse: mouse,\n    gl: defaultRenderer,\n    canvas: defaultCanvas,\n    captured: undefined,\n    canvasRect: {\n      bottom: 0,\n      height: 0,\n      width: 0,\n      left: 0,\n      right: 0,\n      top: 0,\n      x: 0,\n      y: 0\n    },\n    size: {\n      left: 0,\n      top: 0,\n      width: 0,\n      height: 0\n    },\n    viewport: {\n      width: 0,\n      height: 0,\n      factor: 0\n    },\n    initialClick: [0, 0],\n    initialHits: [],\n    subscribe: fn => {\n      state.current.subscribers.push(fn);\n      return () => state.current.subscribers = state.current.subscribers.filter(s => s !== fn);\n    },\n    setManual: takeOverRenderloop => {\n      state.current.manual = takeOverRenderloop;\n\n      if (takeOverRenderloop) {\n        // In manual mode items shouldn't really be part of the internal scene which has adverse effects\n        // on the camera being unable to update without explicit calls to updateMatrixWorl()\n        state.current.scene.children.forEach(child => state.current.scene.remove(child));\n      }\n    },\n    setDefaultCamera: camera => _setDefaultCamera(camera),\n    invalidate: () => invalidate(state),\n    intersect: event => handlePointerMove(event || {})\n  }); // This is used as a clone of the current state, to be distributed through context and useThree\n\n  const sharedState = useRef(state.current); // Writes locals into public state for distribution among subscribers, context, etc\n\n  useLayoutEffect(() => {\n    state.current.ready = ready;\n    state.current.size = size;\n    state.current.camera = defaultCam;\n    state.current.invalidateFrameloop = invalidateFrameloop;\n    state.current.vr = vr;\n  }, [invalidateFrameloop, vr, ready, size, defaultCam]); // Manage canvas element in the dom\n\n  useLayoutEffect(() => {\n    // Add canvas to the view\n    if (bind.current) bind.current.appendChild(defaultCanvas); // Start render-loop, either via RAF or setAnimationLoop for VR\n\n    if (!state.current.vr) invalidate(state);else {\n      defaultRenderer.vr.enabled = true;\n      defaultRenderer.setAnimationLoop(t => renderGl(state, t, 0, true));\n    } // Dispose renderer on unmount\n\n    return () => {\n      if (defaultRenderer) {\n        defaultRenderer.forceContextLoss();\n        defaultRenderer.dispose();\n      }\n      state.current.gl = undefined;\n      state.current.active = false;\n      unmountComponentAtNode(state.current.scene);\n    };\n  }, []); // Update pixel ratio\n\n  useLayoutEffect(() => {\n    if (pixelRatio) defaultRenderer.setPixelRatio(pixelRatio);\n  }, [pixelRatio]); // Adjusts default camera\n\n  useLayoutEffect(() => {\n    state.current.aspect = size.width / size.height || 0;\n\n    if (isOrthographicCamera(state.current.camera)) {\n      state.current.viewport = {\n        width: size.width,\n        height: size.height,\n        factor: 1\n      };\n    } else {\n      const target = new Vector3(0, 0, 0);\n      const distance = state.current.camera.position.distanceTo(target);\n      const fov = Math$1.degToRad(state.current.camera.fov); // convert vertical fov to radians\n\n      const height = 2 * Math.tan(fov / 2) * distance; // visible height\n\n      const width = height * state.current.aspect;\n      state.current.viewport = {\n        width,\n        height,\n        factor: size.width / width\n      };\n    } // Get canvas dom bounds\n\n\n    if (bind.current) state.current.canvasRect = bind.current.getBoundingClientRect();\n\n    if (ready) {\n      defaultRenderer.setSize(size.width, size.height);\n      /* https://github.com/drcmda/react-three-fiber/issues/92\n         Sometimes automatic default camera adjustment isn't wanted behaviour */\n\n      if (updateDefaultCamera) {\n        if (isOrthographicCamera(state.current.camera)) {\n          state.current.camera.left = size.width / -2;\n          state.current.camera.right = size.width / 2;\n          state.current.camera.top = size.height / 2;\n          state.current.camera.bottom = size.height / -2;\n        } else {\n          state.current.camera.aspect = state.current.aspect; // TODO: Why radius??\n          // state.current.camera.radius = (size.width + size.height) / 4\n        }\n\n        state.current.camera.updateProjectionMatrix();\n      }\n\n      invalidate(state);\n    } // Only trigger the context provider when necessary\n\n\n    sharedState.current = _extends({}, state.current);\n  }, [ready, size, defaultCam, updateDefaultCamera]); // This component is a bridge into the three render context, when it gets rendererd\n  // we know we are ready to compile shaders, call subscribers, etc\n\n  const IsReady = useCallback(() => {\n    const activate = useCallback(() => void (setReady(true), invalidate(state)), []);\n    useEffect(() => {\n      if (onCreated) {\n        const result = onCreated(state.current);\n        if (result && result.then) return void result.then(activate);\n      }\n\n      activate();\n    }, []);\n    return null;\n  }, []); // Render v-dom into scene\n\n  useLayoutEffect(() => {\n    if (size.width > 0 && size.height > 0) {\n      render(createElement(stateContext.Provider, {\n        value: sharedState.current\n      }, createElement(IsReady, null), typeof children === 'function' ? children(state.current) : children), state.current.scene, state);\n    }\n  });\n  /** Sets up defaultRaycaster */\n\n  const prepareRay = useCallback(event => {\n    if (event.clientX !== void 0) {\n      const canvasRect = state.current.canvasRect;\n      const left = canvasRect && canvasRect.left || 0;\n      const right = canvasRect && canvasRect.right || 0;\n      const top = canvasRect && canvasRect.top || 0;\n      const bottom = canvasRect && canvasRect.bottom || 0;\n      const x = (event.clientX - left) / (right - left) * 2 - 1;\n      const y = -((event.clientY - top) / (bottom - top)) * 2 + 1;\n      mouse.set(x, y);\n      defaultRaycaster.setFromCamera(mouse, state.current.camera);\n    }\n  }, []);\n  /** Intersects interaction objects using the event input */\n\n  const intersect = useCallback(function (event, prepare) {\n    if (prepare === void 0) {\n      prepare = true;\n    }\n\n    if (prepare) prepareRay(event);\n    const seen = new Set();\n    const hits = []; // Intersect known handler objects and filter against duplicates\n\n    const intersects = defaultRaycaster.intersectObjects(state.current.scene.__interaction, true).filter(item => {\n      const id = makeId(item);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    });\n\n    for (let intersect of intersects) {\n      let receivingObject = intersect.object;\n      let object = intersect.object; // Bubble event up\n\n      while (object) {\n        if (object.__handlers) hits.push(_extends({}, intersect, {\n          object,\n          receivingObject\n        }));\n        object = object.parent;\n      }\n    }\n\n    return hits;\n  }, []);\n  /**  Handles intersections by forwarding them to handlers */\n\n  const handleIntersects = useCallback((event, fn) => {\n    prepareRay(event); // If the interaction is captured, take the last known hit instead of raycasting again\n\n    const hits = state.current.captured && event.type !== 'click' && event.type !== 'wheel' ? state.current.captured : intersect(event, false);\n\n    if (hits.length) {\n      const unprojectedPoint = new Vector3(mouse.x, mouse.y, 0).unproject(state.current.camera);\n\n      for (let hit of hits) {\n        let stopped = {\n          current: false\n        };\n        fn(_extends({}, event, hit, {\n          stopped,\n          unprojectedPoint,\n          ray: defaultRaycaster.ray,\n          // Hijack stopPropagation, which just sets a flag\n          stopPropagation: () => stopped.current = true,\n          sourceEvent: event\n        }));\n        if (stopped.current === true) break;\n      }\n    }\n\n    return hits;\n  }, []);\n  const handlePointer = useCallback(name => event => {\n    if (!state.current.ready) return; // Collect hits\n\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers;\n\n      if (handlers && handlers[name]) {\n        // Forward all events back to their respective handlers with the exception of click,\n        // which must must the initial target\n        if (name !== 'click' || state.current.initialHits.includes(object)) handlers[name](data);\n      }\n    }); // If a click yields no results, pass it back to the user as a miss\n\n    if (name === 'pointerDown') {\n      state.current.initialClick = [event.clientX, event.clientY];\n      state.current.initialHits = hits.map(hit => hit.object);\n    }\n\n    if (name === 'click' && !hits.length && onPointerMissed) {\n      let dx = event.clientX - state.current.initialClick[0];\n      let dy = event.clientY - state.current.initialClick[1];\n      let distance = Math.round(Math.sqrt(dx * dx + dy * dy));\n      if (distance <= 2) onPointerMissed();\n    }\n  }, [onPointerMissed]);\n  const hovered = new Map();\n  const handlePointerMove = useCallback(event => {\n    if (!state.current.ready) return;\n    const hits = handleIntersects(event, data => {\n      const object = data.object;\n      const handlers = object.__handlers; // Check presence of handlers\n\n      if (!handlers) return; // Call mouse move\n\n      if (handlers.pointerMove) handlers.pointerMove(data); // Check if mouse enter or out is present\n\n      if (handlers.pointerOver || handlers.pointerOut) {\n        const id = makeId(data);\n        const hoveredItem = hovered.get(id);\n\n        if (!hoveredItem) {\n          // If the object wasn't previously hovered, book it and call its handler\n          hovered.set(id, data);\n          if (handlers.pointerOver) handlers.pointerOver(_extends({}, data, {\n            type: 'pointerover'\n          }));\n        } else if (hoveredItem.stopped.current) {\n          // If the object was previously hovered and stopped, we shouldn't allow other items to proceed\n          data.stopPropagation(); // In fact, wwe can safely remove them from the cache\n\n          Array.from(hovered.values()).forEach(data => {\n            const checkId = makeId(data);\n\n            if (checkId !== id) {\n              if (data.object.__handlers.pointerOut) data.object.__handlers.pointerOut(_extends({}, data, {\n                type: 'pointerout'\n              }));\n              hovered.delete(checkId);\n            }\n          });\n        }\n      }\n    }); // Take care of unhover\n\n    handlePointerCancel(event, hits);\n    return hits;\n  }, []);\n  const handlePointerCancel = useCallback((event, hits) => {\n    if (!hits) hits = handleIntersects(event, () => null);\n    Array.from(hovered.values()).forEach(data => {\n      if (hits && (!hits.length || !hits.find(i => i.object === data.object))) {\n        const object = data.object;\n        const handlers = object.__handlers;\n        if (handlers && handlers.pointerOut) handlers.pointerOut(_extends({}, data, {\n          type: 'pointerout'\n        }));\n        hovered.delete(makeId(data));\n      }\n    });\n  }, []); // Render the canvas into the dom\n\n  return createElement(\"div\", _extends({\n    ref: bind,\n    onClick: handlePointer('click'),\n    onWheel: handlePointer('wheel'),\n    onPointerDown: handlePointer('pointerDown'),\n    onPointerUp: handlePointer('pointerUp'),\n    onPointerLeave: event => handlePointerCancel(event, []),\n    onPointerMove: handlePointerMove // On capture intersect and remember the last known position\n    ,\n    onGotPointerCapture: event => state.current.captured = intersect(event, false) // On lost capture remove the captured hit\n    ,\n    onLostPointerCapture: event => (state.current.captured = undefined, handlePointerCancel(event))\n  }, rest, {\n    style: _extends({\n      position: 'relative',\n      width: '100%',\n      height: '100%',\n      overflow: 'hidden'\n    }, style)\n  }));\n});\n\nfunction useRender(fn, takeOverRenderloop, deps) {\n  if (takeOverRenderloop === void 0) {\n    takeOverRenderloop = false;\n  }\n\n  if (deps === void 0) {\n    deps = [];\n  }\n\n  const _useContext = useContext(stateContext),\n        subscribe = _useContext.subscribe,\n        setManual = _useContext.setManual; // This calls into the host to inform it whether the render-loop is manual or not\n\n\n  useMemo(() => takeOverRenderloop && setManual(true), [takeOverRenderloop]);\n  useEffect(() => {\n    // Subscribe to the render-loop\n    const unsubscribe = subscribe(fn);\n    return () => {\n      // Call subscription off on unmount\n      unsubscribe();\n      if (takeOverRenderloop) setManual(false);\n    };\n  }, deps);\n}\nfunction useThree() {\n  const _useContext2 = useContext(stateContext),\n        subscribe = _useContext2.subscribe,\n        props = _objectWithoutPropertiesLoose(_useContext2, [\"subscribe\"]);\n\n  return props;\n}\nfunction useUpdate(callback, dependents, optionalRef) {\n  const _useContext3 = useContext(stateContext),\n        invalidate = _useContext3.invalidate;\n\n  const localRef = useRef();\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => {\n    if (ref.current) {\n      callback(ref.current);\n      invalidate();\n    }\n  }, dependents);\n  return ref;\n}\nfunction useResource(optionalRef) {\n  const _useState = useState(),\n        resource = _useState[0],\n        set = _useState[1];\n\n  const localRef = useRef(undefined);\n  const ref = optionalRef ? optionalRef : localRef;\n  useEffect(() => void set(ref.current), [ref.current]);\n  return [ref, resource];\n}\n\n/** experimental */\nfunction useLoader(proto, url, extensions) {\n  const key = useMemo(() => ({}), [url]);\n\n  const _useState2 = useState(() => new WeakMap()),\n        cache = _useState2[0];\n\n  const loader = useMemo(() => {\n    const temp = new proto();\n    if (extensions) extensions(temp);\n    return temp;\n  }, [proto]);\n\n  const _useState3 = useState(false),\n        _ = _useState3[0],\n        forceUpdate = _useState3[1];\n\n  useEffect(() => {\n    if (!cache.has(key)) {\n      loader.load(url, gltf => {\n        const temp = [];\n        gltf.scene.traverse(obj => obj.isMesh && temp.push({\n          geometry: obj.geometry,\n          material: obj.material\n        }));\n        cache.set(key, temp);\n        forceUpdate(i => !i);\n      });\n    }\n  }, [proto, key]);\n  return cache.get(key) || [];\n}\n\nconst apply = objects => {\n  console.warn('react-three-fiber: Please use extend ✅ instead of apply ❌, the former will be made obsolete soon!');\n  extend(objects);\n};\n\nexport { Canvas, addEffect, apply, applyProps, createPortal, extend, invalidate, isOrthographicCamera, render, stateContext, unmountComponentAtNode, useLoader, useRender, useResource, useThree, useUpdate };\n"]},"metadata":{},"sourceType":"module"}